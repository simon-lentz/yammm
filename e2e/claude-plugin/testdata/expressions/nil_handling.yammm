schema "expr_nil_handling"

// Source: expressions.md, "Nil Handling" and "Control Flow Functions" sections

type NilRecord {
    id String primary
    name String[1, 100] required
    nickname String
    score Integer

    // nil guard with both syntaxes
    ! "nil_guard_underscore" nickname == _ || nickname -> Len > 0
    ! "nil_guard_keyword" nickname == nil || nickname -> Len > 0

    // Default
    ! "score_defaulted" score -> Default(0) >= 0

    // Coalesce
    ! "name_present" name -> Coalesce("unnamed") -> Len > 0

    // Then
    ! "nickname_upper" nickname -> Then |$n| { $n -> Upper -> Len > 0 } -> Default(true)

    // Lest
    ! "nickname_fallback" nickname -> Lest { "default" } -> Len > 0

    // IsNil
    ! "score_check" score -> IsNil || score >= 0
}
