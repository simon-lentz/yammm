schema "expr_composed"

// Source: expressions.md, "Composed Expression Examples"

part type ComposedItem {
    name String[1, 100] required
    active Boolean required
    price Float[0.0, _] required
    quantity Integer[1, _] required
}

type ComposedRecord {
    id String primary
    name String[1, 100] required

    *-> ITEMS (many) ComposedItem

    // Filter + All
    ! "active_items_named" ITEMS -> Filter |$i| { $i.active } -> All |$i| { $i.name -> Len > 0 }

    // Map + Sum
    ! "minimum_order_value" ITEMS -> Map |$i| { $i.price * $i.quantity } -> Sum >= 10.0

    // Conditional pipeline
    ! "normalized_name_valid" name -> Lower -> Trim -> Then |$n| { $n -> Len > 0 } -> Default(true)
}
